import{a as p}from"./axios-L6U4YIEh.js";import{M as y,p as M}from"./PaginationComponents-IyIoCn8m.js";import{_ as v,c as n,b as t,F as u,g as h,d as m,e as _,t as i,r as g,o as l,k as w}from"./index-UHb6gj3r.js";var x={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"junapi",BASE_URL:"/Aromatherapy-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:b,VITE_PATH:C}=x,$={data(){return{apiUrl:"https://ec-course-api.hexschool.io",apiPath:"junapi",orders:[],tempCoupons:{},pages:{},modalProduct:null,modalDel:null,isNew:!1}},methods:{checkAdmin(){const o=`${this.apiUrl}/api/user/check`;p.post(o).then(()=>{this.getCoupons()}).catch(e=>{console.log(e),alert(e.response.data.message),window.location="login.html"})},getCoupons(o=1){const e=`${this.apiUrl}/v2/api/${this.apiPath}/admin/orders?page=${o}`;console.log(e),p.get(e).then(s=>{console.log(s),this.orders=s.data.orders,this.pages=s.data.pagination}).catch(s=>{alert(s.message)})},openModal(o,e){o==="new"?(this.tempCoupons={due_date:new Date().getTime()/1e3},this.isNew=!0,this.$refs.pModal.openModal()):o==="edit"?(this.tempCoupons={...e},this.isNew=!1,this.$refs.pModal.openModal()):o==="delete"&&(this.tempCoupons={...e},this.modalDel.show())},updateCoupons(){let o=`${b}/api/${C}/admin/coupon`,e="post";this.isNew||(o=`${b}/api/${C}/admin/coupon/${this.tempCoupons.id}`,e="put"),p[e](o,{data:this.tempCoupons}).then(s=>{console.log(s.message),alert(s.data.message),this.getCoupons(),this.$refs.pModal.closeModal(),this.tempCoupons={}}).catch(s=>{console.log(s),alert(s.message)})},delCoupons(){const o=`${this.apiUrl}/api/${this.apiPath}/admin/order/${this.tempCoupons.id}`;p.delete(o).then(e=>{alert(e.data.message),this.modalDel.hide(),this.getCoupons()}).catch(e=>{alert(e.data.message)})}},mounted(){const o=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");p.defaults.headers.common.Authorization=o,this.checkAdmin(),this.modalDel=new y(this.$refs.delProductModal)},components:{pagination:M}},P={class:"container"},D={class:"text-end mt-4"},T={class:"table mt-4"},V=t("thead",null,[t("tr",null,[t("th",{width:"120"},"訂單建立日期"),t("th",{width:"120"},"訂購人"),t("th",{width:"120"},"訂購品項"),t("th",{width:"120"},"應付金額"),t("th",{width:"150"},"是否付款"),t("th",{width:"80"}," 編輯 ")])],-1),A=["textContent"],E={class:"list-unstyled"},U={key:0,class:"text-success"},L={key:1},N={class:"btn-group"},R=["onClick"],B=["onClick"],I={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},S={class:"modal-dialog"},j={class:"modal-content border-0"},O=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除優惠卷")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),F={class:"modal-body"},H={class:"text-danger"},q={class:"modal-footer"},z=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function G(o,e,s,J,r,d){const f=g("pagination"),k=g("product-modal");return l(),n(u,null,[t("div",P,[t("div",D,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=a=>d.openModal("new"))}," 建立新的訂單 ")]),t("table",T,[V,t("tbody",null,[(l(!0),n(u,null,h(r.orders,a=>(l(),n("tr",{key:a.id},[t("td",null,i(a.create_at),1),t("td",null,[a.user?(l(),n("span",{key:0,textContent:i(a.user.name)},null,8,A)):w("",!0)]),t("td",null,[t("ul",E,[(l(!0),n(u,null,h(a.products,c=>(l(),n("li",{key:c.id},i(c.product.title)+" 數量："+i(c.qty)+" "+i(c.product.unit),1))),128))])]),t("td",null,i(a.total),1),t("td",null,[a.is_paid?(l(),n("span",U,"已付款")):(l(),n("span",L,"未付款"))]),t("td",null,[t("div",N,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:c=>d.openModal("edit",a)}," 檢視 ",8,R),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:c=>d.openModal("delete",a)}," 刪除 ",8,B)])])]))),128))])]),m(f,{pages:r.pages,"get-coupons":d.getCoupons},null,8,["pages","get-coupons"])]),m(k,{"temp-coupons":r.tempCoupons,"update-coupons":d.updateCoupons,ref:"pModal"},null,8,["temp-coupons","update-coupons"]),t("div",I,[t("div",S,[t("div",j,[O,t("div",F,[_(" 是否刪除 "),t("strong",H,i(r.tempCoupons.title),1),_(" 商品(刪除後將無法恢復)。 ")]),t("div",q,[z,t("button",{type:"button",class:"btn btn-danger",onClick:e[1]||(e[1]=(...a)=>d.delCoupons&&d.delCoupons(...a))}," 確認刪除 ")])])])],512)],64)}const X=v($,[["render",G]]);export{X as default};
