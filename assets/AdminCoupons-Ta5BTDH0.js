import{a as u}from"./axios-L6U4YIEh.js";import{M as v,p as $}from"./PaginationComponents-IyIoCn8m.js";import{_ as y,o as i,c,b as o,t as h,j as p,v as m,l as x,F as b,g as V,d as C,e as f,r as g}from"./index-UHb6gj3r.js";const D={props:["isNew","tempCoupons","updateCoupons"],data(){return{modalCoupons:null,editCoupons:{},due_date:""}},watch:{coupon(){this.editCoupons=this.tempCoupons;const e=new Date(this.editCoupons.due_date*1e3).toISOString().split("T");[this.due_date]=e},due_date(){this.editCoupons.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{openModal(){this.modalCoupons.show()},closeModal(){this.modalCoupons.hide()}},mounted(){this.modalCoupons=new v(this.$refs.couponsModal),this.editCoupons=this.tempCoupons}},T={id:"couponsModal",ref:"couponsModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},A={class:"modal-dialog modal-xl"},E={class:"modal-content border-0"},L={class:"modal-header bg-dark text-white"},U={id:"productModalLabel",class:"modal-title"},N={key:0},S={key:1},I=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),P={class:"modal-body"},R={class:"row"},B={class:"col-sm-8"},j={class:"mb-3"},O=o("label",{for:"title",class:"form-label"},"標題",-1),F={class:"row"},H={class:"mb-3 col-md-6"},z=o("label",{for:"percent",class:"form-label"},"折扣",-1),q={class:"mb-3 col-md-6"},G=o("label",{for:"due_date",class:"form-label"},"到期日",-1),J={class:"mb-3 col-md-6"},K=o("label",{for:"code",class:"form-label"},"優惠碼",-1),Q={class:"mb-3"},W={class:"form-check"},X=o("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Y={class:"modal-footer"},Z=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function oo(e,t,s,M,n,a){return i(),c("div",T,[o("div",A,[o("div",E,[o("div",L,[o("h5",U,[s.isNew?(i(),c("span",N,"新增產品")):(i(),c("span",S,"編輯產品"))]),I]),o("div",P,[o("div",R,[o("pre",null,"    "+h(s.tempCoupons)+`
    `,1),o("div",B,[o("div",j,[O,p(o("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":t[0]||(t[0]=l=>n.editCoupons.title=l)},null,512),[[m,n.editCoupons.title]])]),o("div",F,[o("div",H,[z,p(o("input",{id:"percent",type:"number",min:"0",class:"form-control",placeholder:"請輸入折扣","onUpdate:modelValue":t[1]||(t[1]=l=>n.editCoupons.percent=l)},null,512),[[m,n.editCoupons.percent,void 0,{number:!0}]])]),o("div",q,[G,p(o("input",{id:"due_date",type:"date",class:"form-control",placeholder:"請輸入到期日","onUpdate:modelValue":t[2]||(t[2]=l=>n.due_date=l)},null,512),[[m,n.due_date]])])]),o("div",J,[K,p(o("input",{id:"code",type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":t[3]||(t[3]=l=>n.editCoupons.code=l)},null,512),[[m,n.editCoupons.code]])]),o("div",Q,[o("div",W,[p(o("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=l=>n.editCoupons.is_enabled=l)},null,512),[[x,n.editCoupons.is_enabled]]),X])])])])]),o("div",Y,[Z,o("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=(...l)=>s.updateCoupons&&s.updateCoupons(...l))}," 確認 ")])])])],512)}const to=y(D,[["render",oo]]);var eo={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"junapi",BASE_URL:"/Aromatherapy-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:r,VITE_PATH:_}=eo,so={data(){return{coupons:[],tempCoupons:{},pages:{},modalCoupons:null,modalDel:null,isNew:!1}},methods:{checkAdmin(){const e=`${r}/api/user/check`;u.post(e).then(()=>{this.getCoupons()}).catch(t=>{console.log(t),alert(t.message),window.location="login.html"})},getCoupons(e=1){const t=`${r}/api/${_}/admin/coupons?page=${e}`;console.log(t),u.get(t).then(s=>{console.log(s),this.coupons=s.data.coupons,this.pages=s.data.pagination}).catch(s=>{alert(s.message)})},openModal(e,t){e==="new"?(this.tempCoupons={due_date:new Date().getTime()/1e3},this.isNew=!0,this.$refs.pModal.openModal()):e==="edit"?(this.tempCoupons={...t},this.isNew=!1,this.$refs.pModal.openModal()):e==="delete"&&(this.tempCoupons={...t},this.modalDel.show())},updateCoupons(){let e=`${r}/api/${_}/admin/coupon`,t="post";this.isNew||(e=`${r}/api/${_}/admin/coupon/${this.tempCoupons.id}`,t="put"),u[t](e,{data:this.tempCoupons}).then(s=>{console.log(s.message),alert(s.message),this.getCoupons(),this.$refs.pModal.closeModal(),this.tempCoupons={}}).catch(s=>{console.log(s),alert(s.message)})},delCoupons(){const e=`${r}/api/${_}/admin/coupon/${this.tempCoupons.id}`;u.delete(e).then(t=>{alert(t.data.message),this.modalDel.hide(),this.getCoupons()}).catch(t=>{alert(t.data.message)})}},mounted(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");u.defaults.headers.common.Authorization=e,this.checkAdmin(),this.modalDel=new v(this.$refs.delCouponsModal)},components:{pagination:$,couponsModal:to}},no={class:"container"},lo={class:"text-end mt-4"},ao={class:"table mt-4"},io=o("thead",null,[o("tr",null,[o("th",{width:"120"},"優惠名稱"),o("th",{width:"120"},"折扣"),o("th",{width:"120"},"到期日"),o("th",{width:"150"},"是否啟用"),o("th",{width:"80"}," 編輯 ")])],-1),co={key:0,class:"text-success"},uo={key:1},po={class:"btn-group"},ro=["onClick"],ho=["onClick"],mo={id:"delCouponsModal",ref:"delCouponsModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},_o={class:"modal-dialog"},bo={class:"modal-content border-0"},Co=o("div",{class:"modal-header bg-danger text-white"},[o("h5",{id:"delProductModalLabel",class:"modal-title"},[o("span",null,"刪除優惠卷")]),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),fo={class:"modal-body"},go={class:"text-danger"},vo={class:"modal-footer"},yo=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Mo(e,t,s,M,n,a){const l=g("pagination"),k=g("coupons-modal");return i(),c(b,null,[o("div",no,[o("div",lo,[o("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=d=>a.openModal("new"))}," 建立新的優惠卷 ")]),o("table",ao,[io,o("tbody",null,[(i(!0),c(b,null,V(n.coupons,d=>(i(),c("tr",{key:d.id},[o("td",null,h(d.title),1),o("td",null,h(d.percent),1),o("td",null,h(d.due_date),1),o("td",null,[d.is_enabled?(i(),c("span",co,"啟用")):(i(),c("span",uo,"未啟用"))]),o("td",null,[o("div",po,[o("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:w=>a.openModal("edit",d)}," 編輯 ",8,ro),o("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:w=>a.openModal("delete",d)}," 刪除 ",8,ho)])])]))),128))])]),C(l,{pages:n.pages,"get-coupons":a.getCoupons},null,8,["pages","get-coupons"])]),C(k,{"temp-coupons":n.tempCoupons,"update-coupons":a.updateCoupons,ref:"pModal"},null,8,["temp-coupons","update-coupons"]),o("div",mo,[o("div",_o,[o("div",bo,[Co,o("div",fo,[f(" 是否刪除 "),o("strong",go,h(n.tempCoupons.title),1),f(" 商品(刪除後將無法恢復)。 ")]),o("div",vo,[yo,o("button",{type:"button",class:"btn btn-danger",onClick:t[1]||(t[1]=(...d)=>a.delCoupons&&a.delCoupons(...d))}," 確認刪除 ")])])])],512)],64)}const xo=y(so,[["render",Mo]]);export{xo as default};
