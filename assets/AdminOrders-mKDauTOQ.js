import{a as r}from"./axios-L6U4YIEh.js";import{M,p as v}from"./PaginationComponents-jJpgWGfX.js";import{_ as w,c as n,b as t,F as u,g as h,d as m,e as _,t as i,r as b,o as l,l as x}from"./index-SlvrNoUn.js";var k={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"junapi",BASE_URL:"/Aromatherapy-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:g,VITE_PATH:C}=k,P={data(){return{apiUrl:"https://ec-course-api.hexschool.io",apiPath:"junapi",orders:[],tempCoupons:{},pages:{},modalProduct:null,modalDel:null,isNew:!1}},methods:{getCoupons(a=1){const e=`${this.apiUrl}/v2/api/${this.apiPath}/admin/orders?page=${a}`;console.log(e),r.get(e).then(o=>{console.log(o),this.orders=o.data.orders,this.pages=o.data.pagination}).catch(o=>{alert(o.message)})},openModal(a,e){a==="new"?(this.tempCoupons={due_date:new Date().getTime()/1e3},this.isNew=!0,this.$refs.pModal.openModal()):a==="edit"?(this.tempCoupons={...e},this.isNew=!1,this.$refs.pModal.openModal()):a==="delete"&&(this.tempCoupons={...e},this.modalDel.show())},updateCoupons(){let a=`${g}/api/${C}/admin/coupon`,e="post";this.isNew||(a=`${g}/api/${C}/admin/coupon/${this.tempCoupons.id}`,e="put"),r[e](a,{data:this.tempCoupons}).then(o=>{console.log(o.message),alert(o.data.message),this.getCoupons(),this.$refs.pModal.closeModal(),this.tempCoupons={}}).catch(o=>{console.log(o),alert(o.message)})},delCoupons(){const a=`${this.apiUrl}/api/${this.apiPath}/admin/order/${this.tempCoupons.id}`;r.delete(a).then(e=>{alert(e.data.message),this.modalDel.hide(),this.getCoupons()}).catch(e=>{alert(e.data.message)})}},mounted(){this.modalDel=new M(this.$refs.delProductModal)},components:{pagination:v}},$={class:"container"},D={class:"text-end mt-4"},V={class:"table mt-4"},E=t("thead",null,[t("tr",null,[t("th",{width:"120"},"訂單建立日期"),t("th",{width:"120"},"訂購人"),t("th",{width:"120"},"訂購品項"),t("th",{width:"120"},"應付金額"),t("th",{width:"150"},"是否付款"),t("th",{width:"80"}," 編輯 ")])],-1),T=["textContent"],L={class:"list-unstyled"},N={key:0,class:"text-success"},U={key:1},A={class:"btn-group"},R=["onClick"],B=["onClick"],I={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},S={class:"modal-dialog"},j={class:"modal-content border-0"},O=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除優惠卷")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),F={class:"modal-body"},H={class:"text-danger"},q={class:"modal-footer"},z=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function G(a,e,o,J,c,d){const f=b("pagination"),y=b("product-modal");return l(),n(u,null,[t("div",$,[t("div",D,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=s=>d.openModal("new"))}," 建立新的訂單 ")]),t("table",V,[E,t("tbody",null,[(l(!0),n(u,null,h(c.orders,s=>(l(),n("tr",{key:s.id},[t("td",null,i(s.create_at),1),t("td",null,[s.user?(l(),n("span",{key:0,textContent:i(s.user.name)},null,8,T)):x("",!0)]),t("td",null,[t("ul",L,[(l(!0),n(u,null,h(s.products,p=>(l(),n("li",{key:p.id},i(p.product.title)+" 數量："+i(p.qty)+" "+i(p.product.unit),1))),128))])]),t("td",null,i(s.total),1),t("td",null,[s.is_paid?(l(),n("span",N,"已付款")):(l(),n("span",U,"未付款"))]),t("td",null,[t("div",A,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:p=>d.openModal("edit",s)}," 檢視 ",8,R),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:p=>d.openModal("delete",s)}," 刪除 ",8,B)])])]))),128))])]),m(f,{pages:c.pages,"get-coupons":d.getCoupons},null,8,["pages","get-coupons"])]),m(y,{"temp-coupons":c.tempCoupons,"update-coupons":d.updateCoupons,ref:"pModal"},null,8,["temp-coupons","update-coupons"]),t("div",I,[t("div",S,[t("div",j,[O,t("div",F,[_(" 是否刪除 "),t("strong",H,i(c.tempCoupons.title),1),_(" 商品(刪除後將無法恢復)。 ")]),t("div",q,[z,t("button",{type:"button",class:"btn btn-danger",onClick:e[1]||(e[1]=(...s)=>d.delCoupons&&d.delCoupons(...s))}," 確認刪除 ")])])])],512)],64)}const X=w(P,[["render",G]]);export{X as default};
